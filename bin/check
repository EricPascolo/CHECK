#!/usr/bin/env python

#
# CHECK
#
# @authors : Eric Pascolo
#
# Copyright (C) 2017 B.U HPC - CINECA
#
#

from __future__ import print_function
from checklib.inout import commandline
from checklib.core import checkobj_core
import sys
import os
import logging

####--------------------------------------------------------------------------------------------------------------

__author__ = "Eric Pascolo"
__copyright__ = "Copyright 2017, B.U HPC - CINECA"
__credits__ = [""]
__license__ = "GNU Affero GPL v.3"
__version__ = "0.1.001"
__email__ = "eric.pascolo@cineca.it"
__status__ = "Development"


if sys.version_info[:2] < (2,7):
    v_info = sys.version_info[:3]
    sys.exit("CHECK requires Python 2.7 or higher."
             "This is Python %d.%d.%d." % v_info)



##read commandline flag
cl_args = commandline.cl_convert_to_dict(commandline.cl_parser())

##init check setting object
checkcore = checkobj_core.check_core(cl_args)

logger = logging.getLogger(checkcore.setting.logger_name)
logger.critical("CHECK "+__version__+" START ")

## master
if cl_args["master"]:
    from checklib.master import master_runner
    master_runner.main(checkcore)

## daemon 
elif cl_args["daemon"]:
    from checklib.daemon import daemon_manager
    Dcheck = daemon_manager.deamon_manager(checkcore)
    Dcheck.command(cl_args)

## slave
else:
    from checklib.slave import slave_runner
    slave_runner.main(checkcore)


####--------------------------------------------------------------------------------------------------------------
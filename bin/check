#!/usr/bin/env python

#
# CHECKS v 0.1
#
# @authors : Eric Pascolo
#
# Copyright (C) 2017 B.U HPC - CINECA
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Affero General Public License for more details.
#
# You should have received a copy of the GNU Affero General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#

from __future__ import print_function
from checklib.inout import commandline
from checklib.setting import checkobj
import sys
import os
import logging

if sys.version_info[:2] < (2,7):
    v_info = sys.version_info[:3]
    sys.exit("CHECK requires Python 2.7 or higher."
             "This is Python %d.%d.%d." % v_info)


##read commandline flag
cl_args = commandline.cl_parser()

##log
numeric_level = getattr(logging, cl_args.log.upper(), None)
if not isinstance(numeric_level, int):
    raise ValueError('Invalid log level: %s' % cl_args.log)

logging.basicConfig(level=numeric_level)

##init check setting object
setting = checkobj.check_setting(cl_args)

## master
if cl_args.master:
    from checklib.master import master_runner
    master_runner.main(setting)

## slave
else:
    from checklib.slave import slave_runner
    slave_runner.main(setting)
